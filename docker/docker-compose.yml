services:
  # Next.js Application (Supabase only - no local Postgres)
  app:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: hack_the_gap_app
    restart: unless-stopped
    ports:
      - "3000:3000"
    # Load Supabase credentials and URLs directly from project .env
    env_file:
      - ../.env
    environment:
      NODE_ENV: production
    # Migrations against Supabase direct URL, then start Next.js
    command: sh -c "npx prisma migrate deploy && node server.js"

  # Development profile using same Supabase (hot reload)
  dev:
    build:
      context: ..
      dockerfile: docker/Dockerfile.dev
    container_name: hack_the_gap_dev
    restart: unless-stopped
    ports:
      - "3001:3000"
    env_file:
      - ../.env
    environment:
      NODE_ENV: development
    volumes:
      - ..:/app
      - /app/node_modules
      - /app/.next
    profiles:
      - dev
